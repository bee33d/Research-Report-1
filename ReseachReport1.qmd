---
title: "Research Report 1"
format: 
  html:
    self_contained: true
    toc: true
    embed-resources: true
execute:
  echo: true
  warning: false
  message: false 
  error: false
editor: visual
author: "Rached Abir"
date: Feb 2026
---

# Introduction

Moral decision-making is often studied as a balance between intuitive responses and more reflective reasoning. Large-scale experimental datasets, such as the *Moral Machine* study on autonomous vehicle dilemmas, offer a unique opportunity to examine systematic patterns in moral choices across a wide range of contexts. In these scenarios, individuals are repeatedly asked to choose between alternative outcomes involving moral trade-offs, allowing researchers to observe whether choices follow stable distributions or vary depending on situational framing. One important but less explored aspect of such decisions is the role of default options, which are known in other domains of decision-making to exert a strong influence on individual choices.

While global moral preferences show strong regularities in the Moral machine paper, I hypothesize that individuals vary in their propensity to deviate from these majority norms. More specifically, I hypothesize that it is related to cultural context rather than random choice.

**H1:** Deviation from global majority moral preferences varies systematically across scenario types.

**H2:** Deviation from global majority moral preferences is structured by cultural context.

**H3:** The effect of cultural context on deviation from global majority moral preferences depends on scenario type.

## Data Transformation

To test my hypotheses I worked using the ShareResponsesFullFirstSession dataset

library(vroom)

df \<- vroom("SharedResponsesFullFirstSessions.csv", progress = TRUE)

library(dplyr)

set.seed(123)

sampled_ids \<- df %\>% #distinct(ResponseID) %\>% #slice_sample(n = 50000)

df_sample \<- df %\>% \# semi_join(sampled_ids, by = "ResponseID")

df_sample %\>% count(ResponseID, UserID) %\>% count(n) %\>% print(n = 50)

```{r}
df <- readRDS("fullRsample.rds")
```

```{r}
culture <- read.csv("cultures.csv")
```

```{r}
majority_map <- tibble::tibble(
  ScenarioTypeStrict = c("Age", "Utilitarian", "Species", "Fitness"),
  majority_attribute = c("Young", "More", "Hoomans", "Fit")
)
majority_map
```

Attributes such as gender or social status are omitted because their effects, while present, are weak, culturally variable, and lack a consistent global majority direction, unlike the core attributes retained in the table.

```{r}
library(dplyr)
scenario_data <- df %>%
  group_by(ResponseID, UserID, ScenarioTypeStrict,UserCountry3) %>%
  filter(sum(Saved == 1, na.rm = TRUE) == 1) %>%  # exactly one chosen
  summarise(
    chosen_attribute = AttributeLevel[Saved == 1][1],
    .groups = "drop"
  )
```

```{r}
scenario_flagged <- scenario_data %>%
  inner_join(majority_map, by = "ScenarioTypeStrict") %>%
  mutate(against_majority = as.integer(chosen_attribute != majority_attribute)) %>%
  left_join(culture, by = c("UserCountry3" = "countries")) %>%
  rename(cultural_context = categories) %>%
  filter(!is.na(cultural_context), !is.na(ScenarioTypeStrict), !is.na(against_majority))
```

```{r}
scenario_flagged <- scenario_flagged %>%
  mutate(
    cultural_context = trimws(cultural_context),
    cultural_context = na_if(cultural_context, ""),       
    cultural_context = na_if(cultural_context, "NA"),
    cultural_context = na_if(cultural_context, "N/A")
  ) %>%
  filter(!is.na(cultural_context))
```

## Descriptive Statistics

### Scenario level tests:

```{r}
scenario_desc <- scenario_flagged %>%
  group_by(ScenarioTypeStrict) %>%
  summarise(
    n = n(),
    prop_against = mean(against_majority, na.rm = TRUE),
    divisiveness_index = 1 - 2 * abs(prop_against - 0.5), # 1=most divisive, 0=most consensual
    .groups = "drop"
  ) %>%
  arrange(desc(divisiveness_index))
```

```{r}
knitr::kable(scenario_desc, digits = 3, caption = "Scenario-type descriptives")
```

```{r}
library(ggplot2)
library(scales)

ggplot(scenario_desc, aes(x = ScenarioTypeStrict, y = prop_against, fill = ScenarioTypeStrict)) +
  geom_col(show.legend = FALSE) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "H1: Deviation from global majority preferences across scenario types",
    x = "Scenario type",
    y = "Proportion against majority"
  ) +
  theme_minimal()
```

### Cultural context tests:

```{r}
country_data <- scenario_flagged %>%
  group_by(UserCountry3, cultural_context) %>%
  summarise(
    n = n(),
    prop_against = mean(against_majority, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  filter(n >= 200)

culture_desc <- country_data %>%
  group_by(cultural_context) %>%
  summarise(
    n_countries = n(),
    mean_prop_against = mean(prop_against, na.rm = TRUE),
    sd_prop_against = sd(prop_against, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(desc(mean_prop_against))
```

```{r}
knitr::kable(culture_desc, digits = 3, caption = "Cultural-context descriptives")
```

```{r}
ggplot(country_data, aes(x = reorder(cultural_context, prop_against, median), y = prop_against)) +
  geom_boxplot(fill = "#41AE76", alpha = 0.85, outlier.alpha = 0.35) +
  stat_summary(fun = mean, geom = "point", color = "black", size = 2) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "H2: Deviation from majority by cultural context",
    x = "Cultural context",
    y = "Proportion against majority"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Interaction between cultural context and scenario type test:

```{r}
cell_data <- scenario_flagged %>%
  group_by(UserCountry3, cultural_context, ScenarioTypeStrict) %>%
  summarise(
    n = n(),
    prop_against = mean(against_majority, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  filter(n >= 100)
```

```{r}
ggplot(cell_data, aes(x = ScenarioTypeStrict, y = prop_against, color = cultural_context, group = cultural_context)) +
  stat_summary(fun = mean, geom = "line", linewidth = 0.8, alpha = 0.8) +
  stat_summary(fun = mean, geom = "point", size = 2, alpha = 0.9) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "H3: Interaction between cultural context and scenario type",
    x = "Scenario type",
    y = "Proportion against majority",
    color = "Cultural context"
  ) +
  theme_minimal()
```

## Inferential Statistics

### H1:

```{r}
scenario_desc <- scenario_flagged %>%
  group_by(ScenarioTypeStrict) %>%
  summarise(
    n = n(),
    prop_against = mean(against_majority, na.rm = TRUE),
    divisiveness_index = 1 - 2 * abs(prop_against - 0.5), # 1 = most divisive, 0 = strongest consensus
    .groups = "drop"
  ) %>%
  arrange(desc(divisiveness_index))

knitr::kable(scenario_desc, digits = 3, caption = "H1 descriptive: divisiveness by scenario type")
```

```{r}
tab_h1 <- table(scenario_flagged$ScenarioTypeStrict, scenario_flagged$against_majority)
```

```{r}
tab_h1 <- table(scenario_flagged$ScenarioTypeStrict, scenario_flagged$against_majority)
chisq_h1 <- chisq.test(tab_h1)

h1_test <- tibble::tibble(
  statistic = as.numeric(chisq_h1$statistic),
  df = as.numeric(chisq_h1$parameter),
  p_value_raw = chisq_h1$p.value,
  p_value_display = format(chisq_h1$p.value, scientific = TRUE),
  cramer_v = sqrt(as.numeric(chisq_h1$statistic) / (sum(tab_h1) * (min(dim(tab_h1)) - 1)))
)

h1_table <- as.data.frame.matrix(tab_h1)
h1_table <- tibble::rownames_to_column(h1_table, var = "ScenarioTypeStrict")

knitr::kable(h1_table, caption = "H1 contingency table: Scenario Type × Against Majority")

knitr::kable(h1_test, digits = 4, caption = "H1 inferential test: chi-square (Scenario Type × Against Majority)")
```

### H2:

```{r}
country_data <- scenario_flagged %>%
  group_by(UserCountry3, cultural_context) %>%
  summarise(
    n = n(),
    prop_against = mean(against_majority, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  filter(n >= 200)
```

```{r}
fit_h2 <- lm(prop_against ~ cultural_context, data = country_data, weights = n)

h2_coefs <- broom::tidy(fit_h2, conf.int = TRUE)
h2_glance <- broom::glance(fit_h2) %>%
  transmute(
    r_squared = r.squared,
    adj_r_squared = adj.r.squared,
    sigma = sigma,
    statistic_F = statistic,
    p_value_model = p.value,
    df_model = df,
    n_obs = nobs
  )

knitr::kable(h2_coefs, digits = 4, caption = "H2 linear model coefficients")
knitr::kable(h2_glance, digits = 4, caption = "H2 model fit summary")
```

### H3:

```{r}
fit_h3_add <- lm(prop_against ~ cultural_context + ScenarioTypeStrict, data = cell_data, weights = n)
fit_h3_int <- lm(prop_against ~ cultural_context * ScenarioTypeStrict, data = cell_data, weights = n)

h3_coefs <- broom::tidy(fit_h3_int, conf.int = TRUE)
h3_anova_compare <- broom::tidy(anova(fit_h3_add, fit_h3_int))
h3_glance <- broom::glance(fit_h3_int) %>%
  transmute(
    r_squared = r.squared,
    adj_r_squared = adj.r.squared,
    sigma = sigma,
    statistic_F = statistic,
    p_value_model = p.value,
    df_model = df,
    n_obs = nobs
  )

knitr::kable(h3_coefs, digits = 4, caption = "H3 interaction model coefficients")
knitr::kable(h3_anova_compare, digits = 4, caption = "H3 ANOVA model comparison (additive vs interaction)")
knitr::kable(h3_glance, digits = 4, caption = "H3 interaction model fit summary")
```

# Conclusion
